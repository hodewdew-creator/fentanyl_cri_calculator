<!DOCTYPE html>
<html lang="ko">
<head>  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Fentanyl CRI ê³„ì‚°ê¸°</title>
  <meta name="description" content="ì²´ì¤‘ ê¸°ë°˜ Fentanyl CRI ê³„ì‚° Â· ì•½ë¬¼ëŸ‰ ì‚°ì¶œ (ì›ì•¡ 100 Âµg/2 mL/ì•°í”Œ)" />
  <style>
    :root{ --blue:#1d4ed8; --red:#dc2626; --redlight:#fef2f2; --redborder:#fca5a5; --muted:#64748b; --bg:#f8fafc; --card:#fff; --border:#e5e7eb; }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:#0f172a;padding:12px}
    h2{margin:0 0 12px;font-size:1.35rem;color:var(--blue);text-align:center}
    h3{margin:0 0 8px;font-size:1.05rem;color:#111}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:stretch}
    .ibox{border:2px solid var(--blue);border-radius:10px;padding:10px;background:#f9fafb;min-width:160px;flex:1;display:flex;flex-direction:column;justify-content:flex-start}
    .ibox.redtone{border:2px solid var(--redborder);background:var(--redlight)}
    label{display:block;font-size:.9rem;color:var(--blue);margin-bottom:6px}
    .redtone label{color:var(--red)}
    input[type=number],select{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:1rem}
    input:focus,select:focus{outline:none;border-color:var(--blue)}
    .range-row{display:block}
    input[type=range]{width:100%}
    .ticks{display:flex;justify-content:space-between;margin-top:4px;font-size:.75rem;color:#64748b}
    .ticks span{flex:1;text-align:center}
    .ticks span:first-child{text-align:left}
    .ticks span:last-child{text-align:right}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
    .right{text-align:right}
    .total{background:#eff6ff;font-weight:700}
    .note{font-size:.85rem;color:#6b7280}
    .muted{color:#64748b}
    .amp-box{font-size:1rem;color:#111827;background:#f0f9ff;border:2px solid var(--blue);padding:10px;border-radius:10px;font-weight:600;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    .amp-box.redtone{background:#fef2f2;border:2px solid var(--redborder);color:#7f1d1d}
    .warning{font-size:0.8rem;color:#b91c1c;margin-top:20px;line-height:1.4}
  </style>
</head>
<body>
  <h2>Fentanyl CRI ê³„ì‚°ê¸°</h2>

  <div class="card">
    <h3>âš™ï¸ ê¸°ë³¸ ì…ë ¥</h3>
    <div class="row">
      <div class="ibox"><label for="bw">ì²´ì¤‘ (kg)</label><input id="bw" type="number" step="0.1" placeholder="í•„ìˆ˜ì…ë ¥" value=""></div>
      <div class="amp-box" style="flex:1">
        íœíƒ€ë‹ 1 ì•°í”Œ<br>= 100 Âµg / 2 mL<br>(= <span id="stockConc">50</span> Âµg/mL)
      </div>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ§® ì•½ë¬¼ëŸ‰ ê³„ì‚°</h3>
    <div class="ibox" style="margin-bottom:10px">
      <label for="dose"> íœíƒ€ë‹ ìš©ëŸ‰ (Âµg/kg/hr) â€” <b><span id="doseValInline">3.0</span></b></label>
      <div class="range-row">
        <input id="dose" type="range" min="1" max="5" step="0.5" value="3" list="doseTicks">
        <datalist id="doseTicks"><option value="1"></option><option value="2"></option><option value="3"></option><option value="4"></option><option value="5"></option></datalist>
        <div class="ticks"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div>
      </div>
    </div>
    <div class="ibox" style="margin-bottom:10px">
      <label for="hours"> CRI ì´ì‹œê°„ (hr) â€” <b><span id="hoursValInline">12</span></b></label>
      <div class="range-row">
        <input id="hours" type="range" min="6" max="48" step="6" value="12" list="hourTicks">
        <datalist id="hourTicks"><option value="12"></option><option value="24"></option><option value="36"></option><option value="48"></option></datalist>
        <div class="ticks"><span>12</span><span>24</span><span>36</span><span>48</span></div>
      </div>
    </div>

    <table>
      <tbody>
        <tr><td>ì‹œê°„ë‹¹ í•„ìš”ëŸ‰</td><td class="right" id="needPerHr">-</td></tr>
        <tr><td>ì´ í•„ìš”ëŸ‰</td><td class="right" id="needTotal">-</td></tr>
        <tr><td>ì›ì•¡ ê¸°ì¤€ ì´ ë¶€í”¼</td><td class="right" id="needVol">-</td></tr>
      </tbody>
      <tfoot>
        <tr class="total"><td>ì•°í”Œ ìˆ˜</td><td class="right" id="ampCount">-</td></tr>
      </tfoot>
    </table>
  </div>

  <div class="card">
    <h3>ğŸ“ˆ CRI ìˆ˜ì•¡ ì¡°ì œ </h3>
    <div class="row">
      <div class="ibox" style="max-width:220px">
        <label for="flowInput">íŒí”„ ì†ë„ (mL/hr)</label>
        <input id="flowInput" type="number" step="0.1" value="10">
      </div>
      <div class="ibox" style="max-width:220px">
        <label>ì˜ˆìƒ ì´ ë¶€í”¼ (mL)</label>
        <div id="autoV" class="amp-box" style="padding:8px;font-size:.95rem;font-weight:700">-</div>
      </div>
    </div>
    <div class="amp-box" id="mixLine" style="margin-top:12px;font-size:1.05rem"></div>
  </div>

  <!-- ì„ íƒ #1 -->
  <div class="card">
    <h3>(ì„ íƒ) ğŸ’Š ì•°í”Œ â†’ ì‹œê°„ë‹¹ ìš©ëŸ‰ ê³„ì‚°ê¸°</h3>
    <p style="font-size:0.75rem;color:#9ca3af;margin-top:-4px;margin-bottom:8px"> ì‚¬ìš©ì•°í”Œìˆ˜ì™€ ì´ì‹œê°„ìœ¼ë¡œ, ì•„ì´ì˜ ì²´ì¤‘ ê¸°ì¤€ ì‹œê°„ë‹¹ ìš©ëŸ‰(Âµg/kg/hr)ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
    <div class="row">
      <div class="ibox redtone" style="max-width:200px">
        <label for="ampInput">ì‚¬ìš© ì•°í”Œ ìˆ˜</label>
        <input id="ampInput" type="number" step="1" value="2">
      </div>
      <div class="ibox redtone" style="max-width:200px">
        <label for="hours2">ì‚¬ìš© ì‹œê°„ (hr)</label>
        <input id="hours2" type="number" step="1" min="1" value="12">
      </div>
    </div>
    <div id="ampPrep" class="amp-box redtone" style="font-size:1rem;line-height:1.4;margin-top:10px">
      ì•°í”Œ ìˆ˜ì™€ ì‹œê°„ ì„¤ì • ì‹œ, ì‹œê°„ë‹¹ ìš©ëŸ‰ì´ í‘œì‹œë©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- ì„ íƒ #2 -->
  <div class="card">
    <h3>(ì„ íƒ) ğŸ’§ 100mLìˆ˜ì•¡ ì¡°ì œ ê³„ì‚°ê¸°</h3>
    <p style="font-size:0.75rem;color:#9ca3af;margin-top:-4px;margin-bottom:8px"> 100 mL ìˆ˜ì•¡ì— ì•°í”Œ Nê°œë¥¼ í˜¼í•©í–ˆì„ ë•Œ, ì‚¬ìš©ìê°€ ì„ íƒí•œ ì´ CRIì‹œê°„ì— ë”°ë¥¸ ìš©ëŸ‰(Âµg/kg/hr)ì„ ê³„ì‚°í•©ë‹ˆë‹¤. íœíƒ€ë‹ ì›ì•¡ì„ ì²¨ê°€ í›„ ì¦ê°€í•œ ì •í™•í•œ ë¶€í”¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
    <div class="row">
      <div class="ibox redtone" style="max-width:200px">
        <label for="ampInput100">í˜¼í•© ì•°í”Œ ìˆ˜ (ê°œ)</label>
        <input id="ampInput100" type="number" step="1" value="2">
      </div>
      <div class="ibox redtone" style="flex:1;min-width:220px">
        <label for="hours100">ì´ CRI ì‹œê°„ (hr) â€” <b><span id="hours100Val">12</span></b></label>
        <input id="hours100" type="range" min="1" max="48" step="1" value="12">
      </div>
    </div>
    <div id="ampPrep100" class="amp-box redtone" style="font-size:1rem;line-height:1.6;margin-top:10px">
      í˜¼í•© ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
    </div>
  </div>

  <p class="warning">ğŸ“Œ íœíƒ€ë‹ ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­<br>
  - ë¹›ì— ë¯¼ê°í•˜ë¯€ë¡œ ë°˜ë“œì‹œ ì°¨ê´‘ ë³´ê´€í•˜ì„¸ìš”.<br>
  - ê³ ìœ„í—˜ ë§ˆì•½ë¥˜ë¡œ, íˆ¬ì—¬ ì „Â·í›„ ì´ì¤‘ í™•ì¸ ì ˆì°¨ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>
  - ìš©ëŸ‰ ê³¼ë‹¤ ì‹œ í˜¸í¡ì–µì œê°€ ë°œìƒí•  ìˆ˜ ìˆì–´, CRI ì¤‘ì—ëŠ” ì² ì €í•œ ëª¨ë‹ˆí„°ë§ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</p>

<script>
  const $ = (id)=>document.getElementById(id);
  const bw=$('bw'); const dose=$('dose'); const hours=$('hours');
  const flowInput=$('flowInput'); const mixLine=$('mixLine'); const autoV=$('autoV');

  // ì„ íƒ #1
  const ampInput=$('ampInput'); const hours2=$('hours2'); const ampPrep=$('ampPrep');

  // ì„ íƒ #2
  const ampInput100=$('ampInput100'); const hours100=$('hours100');
  const hours100Val=$('hours100Val'); const ampPrep100=$('ampPrep100');

  // í‘œ í…Œì´ë¸”
  const needPerHr=$('needPerHr'), needTotal=$('needTotal'), needVol=$('needVol'), ampCount=$('ampCount');

  // ìƒìˆ˜
  const UG_PER_AMP = 100;   // Âµg
  const ML_PER_AMP = 2;     // mL
  const STOCK_CONC = UG_PER_AMP / ML_PER_AMP; // 50 Âµg/mL
  document.getElementById('stockConc').textContent = STOCK_CONC;

  function fmt(x,d=1){ if(isNaN(x)||!isFinite(x)) return '-'; return Number(x).toFixed(d); }

  // ì„ íƒ #2: 100 mL ë°± í˜¼í•© (ì •í™• ë¶€í”¼)
  function recalcAmpMix100(W){
    if(!ampPrep100) return;
    const N = parseInt(ampInput100?.value);
    const Htot = parseFloat(hours100?.value);
    if(!isNaN(Htot)) hours100Val.textContent = fmt(Htot,0);
    if(isNaN(N) || N<=0){
      ampPrep100.textContent = 'í˜¼í•© ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
      return;
    }
    const totalUg = N * UG_PER_AMP;            // ì´ ì•½ë¬¼ëŸ‰(Âµg)
    const V_exact   = 100 + (N * ML_PER_AMP);  // mL
    const C_exact   = totalUg / V_exact;       // Âµg/mL

    let lines = [`ì´ ì•½ë¬¼ ${fmt(totalUg,0)} Âµg / ì´ ë¶€í”¼ ${fmt(V_exact,0)} mL`,
                 ];

    if(!isNaN(Htot) && Htot>0 && W>0){
      const flow = V_exact / Htot;             // mL/hr (Hì‹œê°„ì— ê· ë“± ì£¼ì… ê°€ì •)
      const dose = (C_exact * flow) / W;       // Âµg/kg/hr
      lines.push(`íœíƒ€ë‹ ìš©ëŸ‰: ${fmt(dose,1)} Âµg/kg/hr <br> (ìˆ˜ì•¡ì†ë„ ${fmt(flow,1)} mL/hr)`);
    }

    ampPrep100.innerHTML = lines.join('<br>');
  }

  function recalc(){
    const W = parseFloat(bw.value);
    const D = parseFloat(dose.value);
    const H = parseFloat(hours.value);

    const validMain = !(isNaN(W)||W<=0||isNaN(D)||D<=0||isNaN(H)||H<=0);

    if(validMain){
      const ugPerHr = D * W;               // Âµg/hr
      const ugTotal = ugPerHr * H;         // Âµg
      const volTotal = ugTotal / STOCK_CONC; // mL of stock
      const amps = ugTotal / UG_PER_AMP;   // amp count

      needPerHr.textContent = `${fmt(ugPerHr,1)} Âµg/hr`;
      needTotal.textContent = `${fmt(ugTotal,1)} Âµg`;
      needVol.textContent = `${fmt(volTotal,2)} mL`;
      ampCount.textContent = `${fmt(amps,2)} amp (ì˜¬ë¦¼ì‹œ ${Math.ceil(amps)} amp)`;

      document.getElementById('doseValInline').textContent = fmt(D,1);
      document.getElementById('hoursValInline').textContent = fmt(H,0);

      const F = parseFloat(flowInput.value);
      const Vfinal = F * H;
      if(!isNaN(F) && F>0){
        autoV.textContent = `${fmt(Vfinal,0)} mL`;
        const Creq = ugPerHr / F;           // Âµg/mL ìš”êµ¬ ë†ë„
        const x = (Creq * Vfinal) / STOCK_CONC; // í•„ìš”í•œ ì›ì•¡ mL
        const dil = Vfinal - x;
        if(x >= 0 && x <= Vfinal){
          mixLine.innerHTML = `ğŸ’‰ ì¡°ì œ: íœíƒ€ë‹ ${fmt(x,2)} mL  +  ğŸ’§ ìˆ˜ì•¡ ${fmt(dil,0)} mL <br>â†’ ì´ ${fmt(Vfinal,0)} mL `;
        } else {
          mixLine.textContent = `âš ï¸ ìš”êµ¬ ë†ë„ê°€ ì›ì•¡ ëŒ€ë¹„ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤.`;
        }
      } else {
        autoV.textContent = '-';
        mixLine.textContent = 'ì²´ì¤‘/ìš©ëŸ‰/ì†ë„ë¥¼ ì…ë ¥í•˜ë©´ ì¡°ì œ ë¹„ìœ¨ì´ í‘œì‹œë©ë‹ˆë‹¤.';
      }
    } else {
      needPerHr.textContent = '-';
      needTotal.textContent = '-';
      needVol.textContent = '-';
      ampCount.textContent = '-';
      mixLine.textContent = 'ì²´ì¤‘/ìš©ëŸ‰/ì†ë„ë¥¼ ì…ë ¥í•˜ë©´ ì¡°ì œ ë¹„ìœ¨ì´ í‘œì‹œë©ë‹ˆë‹¤.';
    }

    // ì„ íƒ #1: ì•°í”Œ â†’ ì‹œê°„ë‹¹ ìš©ëŸ‰
    const ampsUsed = parseInt(ampInput?.value);
    const H2 = parseFloat(hours2?.value);
    if(!isNaN(ampsUsed) && ampsUsed>0 && !isNaN(H2) && H2>0 && W>0){
      const totalDrugUg = ampsUsed * UG_PER_AMP;
      const rateUgHr = totalDrugUg / H2;
      const ratePerKgHr = rateUgHr / W;
      ampPrep.innerHTML = `ì‹œê°„ë‹¹ ìš©ëŸ‰: ${fmt(ratePerKgHr,1)} Âµg/kg/hr Â· ì´íˆ¬ì—¬ëŸ‰ ${fmt(totalDrugUg,0)} Âµg`;
    } else {
      ampPrep.textContent = 'ì•°í”Œ ìˆ˜ì™€ ì‹œê°„ ì„¤ì • ì‹œ, ì‹œê°„ë‹¹ ìš©ëŸ‰ì´ í‘œì‹œë©ë‹ˆë‹¤.';
    }

    // ì„ íƒ #2
    recalcAmpMix100(isNaN(W)?NaN:W);
  }

  [bw,dose,hours,flowInput,ampInput,hours2,ampInput100,hours100].forEach(el=>{
    if(!el) return; ['input','change','keyup'].forEach(e=>el.addEventListener(e,recalc));
  });
  recalc();
</script>
</body>
</html>
